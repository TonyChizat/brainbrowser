/*! 
 * Copyright (C) 2011 McGill University
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 *   the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */
if(!Array.prototype.min){Array.prototype.min=function(){var b=this[0];var a,c;for(a=1,c=this.length;a<c;a++){if(this[a]<b){b=this[a]}}return b}}if(!Array.prototype.max){Array.prototype.max=function(){var a=this[0];var b,c;for(b=1,c=this.length;b<c;b++){if(this[b]>a){a=this[b]}}return a}}function ColorManager(){this.createColorMap=function(k,a,p,f,m,j,l,e,d){var k=k.colors;var c=k.length;var o=((m-f)+(m-f)/c)/c;var g,h;var q;var n;var b;for(g=0,h=p.length;g<h;g++){n=p[g];if(n<=f){q=0}else{if(p[g]>m){q=c-1}else{q=parseInt((n-f)/o)}}if(j){b=255}else{b=1}a[g*4+0]=b*k[q][0]*e+l*b;a[g*4+1]=b*k[q][1]*e+l*b;a[g*4+2]=b*k[q][2]*e+l*b;if(d){a[g*4+3]=b*d}else{a[g*4+3]=b}}return a};this.blendColors=function(h){var a=h[0];var f,d,e,c;var b,g;for(f=0,e=h[0].length/4;f<e;f++){for(d=1,c=h.length;d<c;d++){b=a[f*4+3];g=h[d][f*4+3];a[f*4]=a[f*4]*b+h[d][f*4]*g;a[f*4+1]=a[f*4+1]*b+h[d][f*4+1]*g;a[f*4+2]=a[f*4+2]*b+h[d][f*4+2]*g;a[f*4+3]=b+g}}return a};this.blendColorMap=function(g,f,h,c){var e=f.length;var a=new Array(e);var j=0;var d;var b;for(d=0;d<e;d++){b=f[d];a[d]=this.createColorMap(g,new Array(b.values.length),b.values,b.rangeMin,b.rangeMax,false,0,1,b.alpha)}return blendColors(a)}}function Spectrum(e){var c=this;var a=new ColorManager();function b(f,p,h,o){var j=document.createElement("canvas");var l=new Array(256);var n,m;var g;$(j).attr("width",256);$(j).attr("height",h);for(n=0;n<256;n++){if(o){l[255-n]=n}else{l[n]=n}}f=a.createColorMap(c,[],l,0,255,true,0,1);g=j.getContext("2d");for(m=0;m<256;m++){g.fillStyle="rgb("+parseInt(f[m*4],10)+", "+parseInt(f[m*4+1])+", "+parseInt(f[m*4+2])+")";g.fillRect(m,0,1,p)}return j}c.createSpectrumCanvas=function(f){var g;if(f===null){f=c.colors}g=b(f,20,20,false);return g};c.createSpectrumCanvasWithScale=function(j,f,g,k){var h;var i;if(g===null){g=c.colors}h=b(g,20,40,k);i=h.getContext("2d");i.fillStyle="#FFA000";i.fillRect(0.5,20,1,10);i.fillText(j.toPrecision(3),0.5,40);i.fillRect(h.width/4,20,1,10);i.fillText(((j+f)/4).toPrecision(3),h.width/4,40);i.fillRect(h.width/2,20,1,10);i.fillText(((j+f)/2).toPrecision(3),h.width/2,40);i.fillRect(3*(h.width/4),20,1,10);i.fillText((3*((j+f)/4)).toPrecision(3),3*(h.width/4),40);i.fillRect(h.width-0.5,20,1,10);i.fillText(f.toPrecision(3),h.width-20,40);return h};function d(o){o=o.replace(/^\s+/,"").replace(/\s+$/,"");var m=o.split(/\n/);var f=[];var l,g,j,h;var n;for(l=0,j=m.length;l<j;l++){n=m[l].replace(/\s+$/,"").split(/\s+/);h=n.length;for(g=0;g<h;g++){n[g]=parseFloat(n[g])}if(h<4){n.push(1)}f.push(n)}c.colors=f;return f}if(e!=undefined){d(e)}}function Loader(){var c=this;function a(d,e,f){jQuery.ajax({type:"GET",url:d,dataType:"text",success:function(g){f(g)},error:function(g,i,h){},data:{},async:e,timeout:100000})}function b(g,f){var d=new FileReader();var e=g.files;d.file=e[0];d.onloadend=function(h){f(h.target.result)};d.readAsText(e[0])}c.loadObjFromUrl=function(d){a(d,false,function(e){c.createBrain(new MNIObject(e))})};c.loadObjFromFile=function(d){b(d,function(e){c.createBrain(new MNIObject(e))})};c.loadSpectrumFromUrl=function(e){var d=[];a(e,false,function(f){d=new Spectrum(f);if(c.afterLoadSpectrum!=null){c.afterLoadSpectrum(d)}});return d};c.loadSpectrumFromFile=function(d){b(d,function(f){var e=new Spectrum(f);c.spectrum=e;if(c.afterLoadSpectrum!=null){c.afterLoadSpectrum(e)}if(c.data){c.updateColors(c.data,c.rangeMin,c.rangeMax,c.spectrum)}})}}function Minc(c,a,h){if(!a){a={}}console.log(a);var d=this,f=a.getRawDataParam||"raw_data=true",e=a.getHeaderParam||"minc_headers=true";this.load_headers=function(j){var k=e.split("="),i={};i[k[0]]=k[1];$.ajax({url:j,dataType:"json",data:i,async:false,success:function(l){d.header=l;d.order=l.order;if(d.order.length==4){d.order=d.order.slice(1,d.order.length);d.time=l.time}d.xspace=l.xspace;d.yspace=l.yspace;d.zspace=l.zspace;d.xspace.name="xspace";d.yspace.name="yspace";d.zspace.name="zspace";d.xspace.space_length=parseFloat(d.xspace.space_length);d.yspace.space_length=parseFloat(d.yspace.space_length);d.zspace.space_length=parseFloat(d.zspace.space_length);d.xspace.start=parseFloat(d.xspace.start);d.yspace.start=parseFloat(d.yspace.start);d.zspace.start=parseFloat(d.zspace.start);d.xspace.step=parseFloat(d.xspace.step);d.yspace.step=parseFloat(d.yspace.step);d.zspace.step=parseFloat(d.zspace.step);if(d.order.length==4){d.time.space_length=parseFloat(d.time.space_length);d.time.start=parseFloat(d.time.start);d.time.step=parseFloat(d.time.step)}d[d.order[0]].height=parseFloat(d[d.order[1]].space_length);d[d.order[0]].height_space=d[d.order[1]];d[d.order[0]].length=parseFloat(d[d.order[2]].space_length);d[d.order[0]].length_space=d[d.order[2]];d[d.order[0]].width=parseFloat(d[d.order[2]].space_length);d[d.order[0]].width_space=d[d.order[2]];d[d.order[1]].height=parseFloat(d[d.order[2]].space_length);d[d.order[1]].height_space=d[d.order[2]];d[d.order[1]].length=parseFloat(d[d.order[0]].space_length);d[d.order[1]].length_space=d[d.order[0]];d[d.order[1]].width=parseFloat(d[d.order[0]].space_length);d[d.order[1]].width_space=d[d.order[0]];d[d.order[2]].height=parseFloat(d[d.order[1]].space_length);d[d.order[2]].height_space=d[d.order[1]];d[d.order[2]].length=parseFloat(d[d.order[0]].space_length);d[d.order[2]].length_space=d[d.order[0]];d[d.order[2]].width=parseFloat(d[d.order[0]].space_length);d[d.order[2]].width_space=d[d.order[0]];d[d.order[0]].offset=parseFloat(d[d.order[1]].space_length)*parseFloat(d[d.order[2]].space_length);d[d.order[1]].offset=parseFloat(d[d.order[0]].space_length);d[d.order[2]].offset=parseFloat(d[d.order[0]].space_length);d[d.order[0]].slice_length=d[d.order[0]].height*d[d.order[0]].length},error:function(l,m){throw {request:l,textStatus:m}}})};this.load_data=function(j,l,i){var k=new XMLHttpRequest();if(j.match(/\?/)){j=j+"&"+f}else{j=j+"?"+f}k.open("GET",j,true);k.responseType="arraybuffer";k.onreadystatechange=function(){if(k.readyState==4){if(k.status==200){if(k.mozResponseArrayBuffer!=undefined){d.data=new Uint8Array(k.mozResponseArrayBuffer)}else{d.data=new Uint8Array(k.response)}d.min=0;d.max=255;l(d,i)}}};k.send(null)};this.parseData=function(m,o,j){m=m.replace(/\s+$/,"");m=m.replace(/^\s+/,"");var l=m.split(/\s+/);m="";var n=l.length;for(var k=0;k<n;k++){l[k]=parseInt(l[k])}d.min=l.min();d.max=l.max();l=new Uint16Array(l);d.data=l;o(this,j)};this.sliceFromCoordinates=function(j,i,l,k){};this.slice=function(m,l,o){if(d.order==undefined){return false}if(d.time){if(!o){o=0}var x=o*d[d.order[0]].height*d[d.order[0]].length*parseFloat(d[d.order[0]].space_length)}else{var x=0}var q=d[m].space_length;var n=d[m].step;var t=d[m].length_space.step;var A=d[m].height_space.step;if(d.order[0]==m){var s=d[m].height*d[m].length;var u=d[m].height;var r=d[m].length;var p=1;var v=r;var w=s;var y=new Uint16Array(s);if(t>0){if(A>0){for(var C=0;C<s;C++){y[C]=this.data[x+w*l+C]}}else{for(var C=u;C>0;C--){for(var B=0;B<r;B++){y[(u-C)*r+B]=this.data[x+w*l+C*r+B]}}}}else{if(A<0){for(var C=0;C<u;C++){for(var B=0;B<r;B++){y[C*r+B]=this.data[x+w*l+C*r+r-B]}}}else{for(var C=u;C>0;C--){for(var B=0;B<r;B++){y[(u-C)*r+B]=this.data[x+w*l+C*r+r-B]}}}}}else{if(d.order[1]==m){var u=d[m].height;var s=d[m].height*d[m].length;var r=d[m].length;var p=1;var v=d[d.order[0]].slice_length;var w=d[d.order[0]].length;var y=new Uint16Array(s);if(A<0){for(var B=0;B<u;B++){for(var z=0;z<r;z++){y[B*(r)+z]=d.data[x+l*w+v*z+B]}}}else{for(var B=u;B>=0;B--){for(var z=0;z<r;z++){y[(u-B)*(r)+z]=d.data[x+l*w+v*z+B]}}}}else{var u=d[m].height;var s=d[m].height*d[m].length;var r=d[m].length;var p=d[d.order[0]].slice_length;var v=d[d.order[0]].length;var w=1;var y=new Uint16Array(s);for(var B=0;B<u;B++){for(var z=0;z<r;z++){y[B*(r)+z]=d.data[x+l+d[d.order[0]].length*B+z*d[d.order[0]].slice_length]}}}}return y};this.nearestNeighboor=function(p,l,v,m,k){var r=new Uint16Array(m*k);var t=l/m;var q=v/k;for(var o=0;o<k;o++){for(var n=0;n<m;n++){var u=Math.floor(n*t);var s=Math.floor(o*q);r[Math.floor(o*m+n)]=p[Math.floor(s*l+u)]}}return r};function b(p,n,k){var o=new Uint16Array(n*k);for(var m=0;m<n;m++){for(var l=0;l<k;l++){o[m*k+l]=p[l*n+(n-m)]}}return o}function g(p,n,k){var o=new Uint16Array(n*k);for(var m=0;m<n;m++){for(var l=0;l<k;l++){o[m*k+l]=p[(k-l)*n+m]}}return o}this.getScaledSlice=function(m,o,l,r){var n=d.slice(m,o,l);var j=d[m].length;var q=d[m].height;var k=Math.ceil(Math.abs(d[m].length_space.step)*j*r);var i=Math.ceil(Math.abs(d[m].height_space.step)*q*r);var p=this.nearestNeighboor(n,j,q,k,i);if(m=="xspace"&&d.xspace.height_space.name=="yspace"){if(d.zspace.step<0){p=g(p,k,i)}else{p=b(p,k,i)}}if(m=="yspace"&&d.yspace.height_space.name=="xspace"){if(d.zspace.step<0){p=g(p,k,i)}else{p=b(p,k,i)}}if(m=="zspace"&&d.zspace.height_space.name=="xspace"){p=b(p,k,i)}return p};this.getValueAtLocation=function(i,l,k,j){};if(c!=null&&h!=null){this.load_headers(c);this.load_data(c,h,a)}}function BrainCanvas(b){if(!b){b={}}var j=this;var h=new ColorManager(),c=b.xcanvas||document.createElement("canvas"),n=b.ycanvas||document.createElement("canvas"),e=b.zcanvas||document.createElement("canvas"),g=c.getContext("2d"),f=n.getContext("2d"),d=e.getContext("2d");c.zoom=1;n.zoom=1;e.zoom=1;c.translate_origin={x:0,y:0};n.translate_origin={x:0,y:0};e.translate_origin={x:0,y:0};c.translate_vector={x:0,y:0};n.translate_vector={x:0,y:0};e.translate_vector={x:0,y:0};var m=new Loader();j.slices={};j.brightness=0;j.contrast=1;var i={spectral:m.loadSpectrumFromUrl("/spectrum/spectral-brainview.txt"),grayscale:m.loadSpectrumFromUrl("/spectrum/gray_scale256.txt")};var k=i.spectral;j.spectrums=i;this.initCanvas=function(p,r,o){p.width=r;p.height=o;var q=p.getContext("2d");q.fillStyle="#000000";q.fillRect(0,0,r,o)};this.update_space=function(s,q,p,t,w,r){j.slices[s]=t;j.slices[s].space_height=Math.ceil(Math.abs(w[s].height_space.step)*w[s].height_space.space_length*q.zoom);var o=Math.ceil(Math.abs(w[s].length_space.step)*w[s].length_space.space_length*q.zoom);var x=Math.ceil(Math.abs(w[s].height_space.step)*w[s].height_space.space_length*q.zoom);q.current_image={width:o,height:x};if(s=="xspace"&&w.xspace.height_space.name=="yspace"){q.current_image.width=x;q.current_image.height=o}if(s=="yspace"&&w.yspace.height_space.name=="xspace"){q.current_image.width=x;q.current_image.height=o}if(s=="zspace"&&w.zspace.height_space.name=="xspace"){q.current_image.width=x;q.current_image.height=widht}var u=p.createImageData(q.current_image.width,q.current_image.height);var v=w.getScaledSlice(s,t,r,q.zoom);u.data=h.createColorMap(k,u.data,v,w.min,w.max,true,j.brightness,j.contrast);p.putImageData(u,q.translate_vector.x,q.translate_vector.y)};function a(p,o,q){p.fillStyle="#FF0000";p.fillRect(o-2,q-2,4,4)}this.updateXSpace=function(p,o,q){j.update_space("xspace",c,g,p,o,q)};this.updateYSpace=function(p,o,q){j.update_space("yspace",n,f,p,o,q)};this.updateZSpace=function(p,o,q){j.update_space("zspace",e,d,p,o,q)};this.showCrosshairs=function(){if(j.current_minc.xspace.step<0){var t=(j.current_minc.xspace.space_length-j.slices.xspace)*Math.abs(j.current_minc.yspace.step);var s=t}else{var t=j.slices.xspace*Math.abs(j.current_minc.yspace.step);var s=t}if(j.current_minc.yspace.step>0){var o=(j.current_minc.yspace.space_length-j.slices.yspace)*Math.abs(j.current_minc.yspace.step);var r=j.slices.yspace*Math.abs(j.current_minc.yspace.step)}else{var o=j.slices.yspace*Math.abs(j.current_minc.yspace.step);var r=(j.current_minc.yspace.space_length-j.slices.yspace)*Math.abs(j.current_minc.yspace.step)}if(j.current_minc.zspace.step>0){var p=(j.current_minc.zspace.space_length-j.slices.zspace)*Math.abs(j.current_minc.zspace.step);var q=p}else{var p=j.slices.zspace*Math.abs(j.current_minc.zspace.step);var q=p}a(g,r*c.zoom+c.translate_vector.x,p*c.zoom+c.translate_vector.y);a(f,s*n.zoom+n.translate_vector.x,p*n.zoom+n.translate_vector.y);a(d,s*e.zoom+e.translate_vector.x,o*e.zoom+e.translate_vector.y)};j.showCoordinates=function(){$('<div id="coordinates">x:<span id="x"></span> y:<span id="y"></span> z:<span id="z"></span></div>').appendTo($(c).parent())};j.updateCoordinates=function(o){$(c).siblings("#coordinates").children("#x").html(o.x);$(c).siblings("#coordinates").children("#y").html(o.y);$(c).siblings("#coordinates").children("#z").html(o.z)};this.updateSlices=function(p,q){j.current_time=q;if(p){var o=j.getSliceNumbersFromPosition(l(p))}else{var o={x:j.slices.xspace,y:j.slices.yspace,z:j.slices.zspace}}j.initCanvas(c,c.width,c.height);j.initCanvas(n,n.width,n.height);j.initCanvas(e,e.width,e.height);j.updateXSpace(o.x,j.current_minc,q);j.updateYSpace(o.y,j.current_minc,q);j.updateZSpace(o.z,j.current_minc,q);j.showCrosshairs();j.updateCoordinates(j.sliceToWorldCoordinates(o))};this.zoomIn=function(p,o,q){if(o.zoom==undefined){o.zoom=1*1.01}else{o.zoom=o.zoom*1.1}j.updateSlices(null,j.current_time)};this.zoomOut=function(p,o,q){if(o.zoom==undefined){o.zoom=0.9}else{o.zoom=o.zoom*0.9}j.updateSlices(null,j.current_time)};this.translate=function(p,o){var q=l(p);if(o.translate_origin){o.translate_vector={x:(o.translate_origin.x-q.x2),y:(o.translate_origin.y-q.y)};j.updateSlices(null,j.current_time)}};this.showMinc=function(o){$(c).siblings("#mincinfo").append("Minc Information: <br>order: "+o.order+"<br>xspace.height: "+o.xspace.height+" yspace.height: "+o.yspace.height+" zspace.height: "+o.zspace.height+"<br> xspace.length: "+o.xspace.length+" yspace.length: "+o.yspace.length+" zspace.length: "+o.zspace.length+"xspace step: "+o.xspace.step+"yspace step: "+o.yspace.step+"zspace step: "+o.zspace.step);j.slices.xspace=parseInt(o.xspace.length/2);j.slices.yspace=parseInt(o.yspace.length/2);j.slices.zspace=parseInt(o.zspace.length/2);j.updateXSpace(j.slices.xspace,o);j.updateYSpace(j.slices.yspace,o);j.updateZSpace(j.slices.zspace,o);j.showCrosshairs();j.updateCoordinates(o.xspace.length/2,o.yspace.length/2,o.zspace.length/2)};function l(p){var o;var q;if(p.pageX!=undefined&&p.pageY!=undefined){o=p.pageX;q=p.pageY}else{o=p.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;q=p.clientY+document.body.scrollTop+document.documentElement.scrollTop}o-=p.target.offsetLeft;q-=p.target.offsetTop;q=p.target.height-q;return{target:p.target,x:o,y:q,x2:p.target.width-o}}this.sliceToWorldCoordinates=function(u){var s=j.current_minc.xspace.start;var p=j.current_minc.xspace.step;var r=j.current_minc.yspace.start;var t=j.current_minc.yspace.step;var o=j.current_minc.zspace.start;var q=j.current_minc.zspace.step;return{x:s+u.x*p,y:r+u.y*t,z:o+u.z*q}};this.getSliceNumbersFromPosition=function(o){j.position=o;if(o.target.id==c.id){var p={x:j.slices.xspace,y:parseInt((o.x-c.translate_vector.x)/Math.abs(j.current_minc.xspace.height_space.step)/c.zoom),z:parseInt((o.y+c.translate_vector.y-(c.height-c.current_image.height))/Math.abs(j.current_minc.xspace.length_space.step)/c.zoom)};if(j.current_minc.yspace.step<0){p.y=j.current_minc.yspace.space_length-p.y}if(j.current_minc.zspace.step<0){p.z=j.current_minc.zspace.space_length-p.z}}else{if(o.target.id==n.id){var p={y:j.slices.yspace,x:parseInt((o.x-n.translate_vector.x)/(Math.abs(j.current_minc.xspace.step)*n.zoom)),z:parseInt((o.y+n.translate_vector.y-(n.height-n.current_image.height))/(Math.abs(j.current_minc.zspace.step)*n.zoom))};if(j.current_minc.xspace.step<0){p.x=j.current_minc.xspace.space_length-p.x}if(j.current_minc.zspace.step<0){p.z=j.current_minc.zspace.space_length-p.z}}else{var p={z:j.slices.zspace,x:parseInt((o.x-e.translate_vector.x)/(Math.abs(j.current_minc.zspace.length_space.step)*e.zoom)),y:parseInt((o.y+e.translate_vector.y-(e.height-e.current_image.height))/(Math.abs(j.current_minc.yspace.step)*e.zoom))};if(j.current_minc.xspace.step<0){p.x=j.current_minc.xspace.space_length-p.x}if(j.current_minc.yspace.step<0){p.y=j.current_minc.yspace.space_length-p.y}}}return p};this.addListeners=function(o){o.onmousedown=function(q){j.drag=true;if(q.shiftKey){var p=l(q);o.translate_origin={x:o.translate_vector.x+p.x2,y:o.translate_vector.y+p.y}}return false};o.onmouseup=function(p){j.drag=false};o.onmousemove=function(p){if(j.drag){if(p.shiftKey){j.translate(p,o)}else{j.updateSlices(p)}}};jQuery(o).mousewheel(function(p,q){if(q>0){j.zoomIn(p,o,q)}else{j.zoomOut(p,o,q)}return false})};this.showTime=function(){$('<div id="time">Time Index: </div>').appendTo($(c).parent());var o={playing:false,position:0};var t=$($(c).parent().children("#time"));$('<span id="time-value">1</span>').appendTo(t);$('<div id="time-slider" width="'+c.width+'" + height="10"></div>').slider({value:0,min:0,max:j.current_minc.time.space_length,step:1,change:function(u,v){console.log("BLAH!");j.updateSlices(null,v.value);o.position=v.value;$(t).children("#time-value").html(v.value)},slide:function(u,v){console.log("BLAH!");j.updateSlices(null,v.value);o.position=v.value;$(t).children("#time-value").html(v.value)}}).appendTo(t);$('<div class="toolbar"><span id="time-toolbar" class="ui-widget-header ui-corner-all"><button id="play">play</button><button id="stop">stop</button></span></div>').appendTo(t);function q(){if(o.playing){o.position+=1;if(o.position>j.current_minc.time.space_length){o.position=0}$(t).children("#time-slider").slider("value",o.position);setTimeout(q,500)}}function s(){o.playing=true;q()}function r(){o.playing=false}function p(){o.playing=false;o.position=0;$(t).children("#time-slider").slider("value",o.position)}$("#time-toolbar").children("#play").button({label:"play",text:false,icons:{primary:"ui-icon-play"}}).click(function(){var u;if($(this).text()==="play"){u={label:"pause",icons:{primary:"ui-icon-pause"}};s()}else{u={label:"play",icons:{primary:"ui-icon-play"}};r()}$(this).button("option",u)});$("#time-toolbar").children("#stop").button({label:"stop",text:false,icons:{primary:"ui-icon-stop"}}).click(function(){$("#play").button("option",{label:"play",icons:{primary:"ui-icon-play"}});p()})};this.showBrightness=function(){$('<div id="brightness">Brightness: </div>').appendTo($(c).parent());var o=$($(c).parent().children("#brightness"));$('<span id="brightness-value">0%</span>').appendTo(o);$('<div id="brightness-slider" width="100px" + height="10"></div>').slider({value:0,min:-1,max:1,step:0.1,slide:function(p,q){j.brightness=q.value;j.updateSlices(null,j.current_time);$(o).children("#brightness-value").html(q.value*100+"%")}}).appendTo(o)};this.showContrast=function(){$('<div id="contrast">Contrast: </div>').appendTo($(c).parent());var o=$($(c).parent().children("#contrast"));$('<span id="contrast-value">1</span>').appendTo(o);$('<div id="contrast-slider" width="100px" + height="10"></div>').slider({value:1,min:1,max:5,step:0.1,slide:function(p,q){j.contrast=q.value;j.updateSlices(null,j.current_time);$(o).children("#contrast-value").html(q.value)}}).appendTo(o)};this.changeSpectrum=function(o){k=i[o];j.updateSlices(null,j.time)};this.showSpectrum=function(){$('<div id="spectrum">Color Scale</div>').appendTo($(c).parent());var o=$($(c).parent().children("#spectrum"));$('<select id="spectrum-select"><option value="spectral">Spectral</option><option value="grayscale">Gray Scale</option></select>').appendTo(o);$(o).children("#spectrum-select").change(function(p){j.changeSpectrum($(p.target).val())})};this.openFile=function(o){this.current_minc=new Minc(o,b,function(q,r){var p=b.canvasHeight||256,s=b.canvasWidth||256;j.initCanvas(c,s,p);j.initCanvas(n,s,p);j.initCanvas(e,s,p);j.showCoordinates();j.showMinc(q);if(q.time){j.showTime()}j.showBrightness();j.showContrast();j.showSpectrum();j.addListeners(c);j.addListeners(n);j.addListeners(e)})}};